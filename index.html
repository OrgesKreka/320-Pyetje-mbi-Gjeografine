<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="shortcut icon" href="./resources/images/icon.png" type="image/x-icon" />
    <title>320 Pyetje mbi Gjeografinë</title>
    <link rel="stylesheet" href="./vendors/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./resources/css/style.css">
    <script src="./vendors/jquery/jquery.js"></script>
    <script src="./vendors/bootstrap/js/bootstrap.min.js"> </script>
    <link rel="stylesheet" href="./vendors/font-awesome/all.min.css" />
    <script src="./vendors/font-awesome/all.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Baloo+Chettan+2&display=swap" rel="stylesheet">


    <!-- Scrollbar Custom CSS -->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
</head>

<body>

    <div class="d-flex" id="wrapper">

        <!-- Sidebar -->
        <div class="bg-light border-right" id="sidebar-wrapper">
            <div class="sidebar-heading">
                <h3>Përmbajtja</h3>
            </div>
            <div class="list-group list-group-flush">
                <nav class="navbar justify-content-sm-start">
                    <ul class="list-unstyled components sidebar-content">
                        <li class="active">
                            <a href="#entrySubmenu"
                                class="dropdown-toggle list-group-item list-group-item-action bg-light"
                                data-toggle="collapse" aria-expanded="false">Hyrje</a>
                            <ul class="collapse list-unstyled" id="entrySubmenu">
                                <li>
                                    <a href="#shenim">Shënim</a>
                                </li>
                                <li>
                                    <a href="#parathenie">Parathënie</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- Page Content -->
        <div id="page-content-wrapper">

            <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom" >
                <button class="btn btn-primary" id="menu-toggle">
                    <i class="fas fa-arrow-left" id="sidebar-icon"></i>
                </button>

                <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto mt-2 mt-lg-0 justify-content-center">
                        <li class="nav-item">
                            <h3><b>320 pyetje mbi Gjeografinë &emsp;</b></h3>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link px-2" href="https://github.com/OrgesKreka/320-Pyetje-mbi-Gjeografine"
                                target="_blank" title="Projekti në Github"><span class="fab fa-github"></span> Projekti në Github &emsp;</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link px-2" href="https://www.facebook.com/orges.kreka" target="_blank"
                                title="Profili im në facebook"><span class="fab fa-facebook"></span> Profili në Facebook &emsp;</a>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="container-fluid">
                <div class="modal-dialog" id="loading-modal" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Duke ngarkuar pyetjet...</h5>
                        </div>
                        <div class="loader">Loading...</div>
                    </div>
                </div>
    
                <br />
                

                <div id="book-content"> </div>
            </div>

            <footer>
                <div class="container page-footer">
                    <div class="text-muted"> <center> &copy; Copyright 2020 </center> </div>
                </div>
            </footer>
        </div>
        <!-- /#page-content-wrapper -->

    </div>
    </main>
</body>

<script>

    var bulbSection = "<p> <i class='fas fa-lightbulb' style='color:#7386d5;'></i>. Shih përgjigjen </p>";
    var pageContent = $('#book-content');
    var contentString = "";

    $("#menu-toggle").click(function (e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });

    function createInfoJumbotron(info){
        var jumbotron = "<div class='jumbotron' id='shenim'>"
                      + "<h1 class='display-4'>Shënim</h1>" 
                      + "<hr class='my-4'>"
                      + "<p>" + info.Shenim1 + "</p>"
                      + "<div class='card text-white bg-danger mb-3'>"
                      + "<div class='card-body'>"
                      + "<p class='card-text'>" + info.Shenim2 + "</p>"
                      + "</div>"
                      + "</div>"
                      + "<hr class='my-4'>"
                      + "<p>" + info.Shenim3 + "</p>"
                      + "<hr class='my-4'>"
                      + "<p>" + info.Shenim4 + "</p>";
                      +"</div>";

        return jumbotron;
    }

    // Leximi i permbajtjes dhe ndertimi i pyetjeve
    function createContentAsync() {
        return Promise.resolve().then(v => {
            createContent();
        });
    }

    function createQuestionDiv(question) {
        var questionNumber = question.Nr;
        var rating = question.Vleresimi;
        var questionText = question.Pyetja;
        var responseText = question.Pergjigja;
        var imagePath = question.VendodhjaImazhit;
        var questionId = 'answer-' + questionNumber;
        var captionRegex = /figura-\d+/gm;
        var tableClass = ''
        var badgeClass = ''
        var imageDiv = '';

        if (questionNumber == 262) {
            var responseTable = createTableResponse(JSON.parse(responseText).Pergjigja262);
            responseText = responseTable.outerHTML;
            tableClass = 'table-responsive-sm';
        } else {
            tableClass = '';
        }

        switch (rating) {
            case 1:
                badgeClass = 'badge badge-success';
                break;
            case 2:
                badgeClass = 'badge badge-warning';
                break;
            case 3:
                badgeClass = 'badge badge-danger';
                break;
        }

        if (imagePath != null && imagePath.length > 0) {
            var figureCaption = imagePath.match(captionRegex);

            imageDiv =
                "<div>"
                + "<figure>"
                + "<img src='" + imagePath + "' class='img-fluid' alt='' width='400' height='500' />"
                + "<figcaption><i> " + figureCaption[0] + "</i></figcaption>"
                + "</figure>"
                + "</div>"
                + "<br />";
        }
        else {
            imageDiv = '';
        }


        var questionContent = "<p class='question'> " +
            "<span class='" + badgeClass + "'> " +
            "<b>" + questionNumber + "</b>. " +
            "</span> " +
            questionText +
            "</p>" +
            imageDiv;

        var refElementContent = "<a href='#" + questionId + "' aria-controls='" + questionId + "' data-toggle='collapse' aria-expanded='false'>"
            + bulbSection
            + "</a>";

        var fooDiv = "<div id='" + questionId + "' class='collapse'>"
            + "<div class='card card-body " + tableClass + "'>"
            + "<i>" + responseText + "</i>"
            + "</div>"
            + "</div>"
            + "<br />";


        var questionDiv = "<div>"
            + questionContent
            + refElementContent
            + fooDiv
            + "</div>";

        //contentString += questionDiv;
        return questionDiv;
    }

    function createTableResponse(jsonResponse) {

        // Extract value for html header.
        var header = [];
        for (var i = 0; i < jsonResponse.length; i++) {
            for (var key in jsonResponse[i]) {
                if (header.indexOf(key) === -1)
                    header.push(key);
            }
        }

        // Create dynamic table
        var table = document.createElement("table");
        table.setAttribute('class', 'table');
        // Adding the header rows to created table
        var tr = table.insertRow(-1);

        for (var i = 0; i < header.length; i++) {
            var th = document.createElement("th");
            th.innerHTML = header[i];
            tr.appendChild(th);
        }

        // Add json data as table rows
        for (var i = 0; i < jsonResponse.length; i++) {
            tr = table.insertRow(-1);

            for (var j = 0; j < header.length; j++) {

                var tableCell = tr.insertCell(-1);
                tableCell.innerHTML = jsonResponse[i][header[j]];
            }
        }

        return table;
    }


    function createContent() {

        $.getJSON('./data/320-pyetje-mbi-gjeografine.json', function (content) {

            $(createInfoJumbotron( content.Shenime )).insertBefore(pageContent);

            contentString = "<div id='parathenie' class='card mb-3'>"
                + "<div class='row no-gutters'>"
                + "<div class='col-md-4'>"
                + "<center class='book-cover'><img src='./resources/images/libri.jpg' class='img-fluid center-block' width='600' height='800'></center>"
                + "</div>"
                + "<div class='col-md-8'>"
                + "<div class='card-body'>"
                + "<h5 class='card-title'> <span class='badge badge-danger'><b>Parathënie </b></span></h5>"
                + "<p class='card-text'>" + content.Parathenie + "</p>"
                + "</div>"
                + "</div>"
                + "</div>"
                + "</div>"
                + "<br />"
                + "</br>";

            var sidebarContent = '';
            var partId = 1;
            content.Permbajtja.forEach(element => {

                var sideBarMenuLink = '<li>'
                    + "<a href='#pjesa" + partId + "' class='dropdown-toggle list-group-item list-group-item-action bg-light' data-toggle='collapse' aria-expanded='false'>" + element.Pjesa + "</a>"
                    + "<ul class='collapse list-unstyled' id='pjesa" + partId + "'>";
                
                partId++;

                element.Kapitujt.forEach(chapter => {

                    var chapterDiv = "<div id='chapter-" + partId + '-' + chapter.NrKapitulli +  "' class='border border-success rounded'>"
                                   + "<h5 class='card-title'>"  + chapter.Kapitulli + "</h5>"
                                   + "<hr />";


                    sideBarMenuLink += "<li>"
                        + "<a href='#chapter-" + partId + '-' + chapter.NrKapitulli + "'>" + chapter.Kapitulli + "</a>";
                        + "</li>";

                    chapter.Pyetjet.forEach(question => {
                       chapterDiv += createQuestionDiv(question);
                    });

                    chapterDiv += "</div>" + "<br/>";
                    contentString += chapterDiv;
                });

                sideBarMenuLink += "</ul>";
                sideBarMenuLink += "</li>";

                sidebarContent += sideBarMenuLink;
            });

            $('.sidebar-content').append(sidebarContent);
            pageContent.append(contentString);
        });
    }


    $(window).on('load', function () {
        var loadingDiv = $('#loading-modal');


        loadingDiv.show();
        setTimeout(async () => {
            await createContentAsync();
            loadingDiv.hide();
        }, 5000);

    });
</script>

</html>